# **é…ç½®ç®¡ç†åŸŸæŠ€æœ¯æ–‡æ¡£**

---

## **1. æ¦‚è¿°**

**é…ç½®ç®¡ç†åŸŸ**æ˜¯ `mermaid-fixer` ç³»ç»Ÿçš„**æ ¸å¿ƒå†³ç­–ä¸­æ¢**ï¼Œè´Ÿè´£ç»Ÿä¸€ç®¡ç†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰è¿è¡Œæ—¶é…ç½®ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡Œå‚æ•°ã€é…ç½®æ–‡ä»¶ï¼ˆ`config.toml`ï¼‰ã€ç¯å¢ƒå˜é‡çš„åŠ è½½ã€åˆå¹¶ä¸ä¼˜å…ˆçº§å¤„ç†ã€‚è¯¥æ¨¡å—ç¡®ä¿ç³»ç»Ÿåœ¨ä»»ä½•å¯åŠ¨åœºæ™¯ä¸‹ï¼ˆé¦–æ¬¡è¿è¡Œã€CI/CD ç¯å¢ƒã€å¼€å‘è°ƒè¯•ï¼‰éƒ½èƒ½è·å¾—**ä¸€è‡´ã€æœ‰æ•ˆã€å¯é¢„æµ‹**çš„é…ç½®çŠ¶æ€ï¼Œæ˜¯å®ç°â€œ**é…ç½®é©±åŠ¨å¼€å‘**â€æ¶æ„é£æ ¼çš„åŸºçŸ³ã€‚

ä½œä¸ºç³»ç»Ÿä¸­å”¯ä¸€æ‹¥æœ‰**é…ç½®å†™å…¥èƒ½åŠ›**çš„æ¨¡å—ï¼Œå®ƒä¸ä»…æ‰¿æ‹…è¯»å–èŒè´£ï¼Œè¿˜å…·å¤‡**è‡ªæ„ˆèƒ½åŠ›**â€”â€”åœ¨ç¼ºå¤±é…ç½®æ–‡ä»¶æ—¶è‡ªåŠ¨åˆ›å»ºé»˜è®¤é…ç½®ï¼Œä¿éšœå·¥å…·çš„â€œå¼€ç®±å³ç”¨â€ç‰¹æ€§ã€‚å…¶è®¾è®¡ä¸¥æ ¼éµå¾ª**å•ä¸€èŒè´£åŸåˆ™**ä¸**é…ç½®ä¸­å¿ƒåŒ–**ç†å¿µï¼Œæ‰€æœ‰å…¶ä»–æ¨¡å—å‡é€šè¿‡å…¶æš´éœ²çš„æ ‡å‡†åŒ–æ¥å£è·å–é…ç½®ï¼Œå®ç°é«˜å†…èšã€ä½è€¦åˆçš„æ¶æ„ç›®æ ‡ã€‚

---

## **2. æ ¸å¿ƒèŒè´£**

| èŒè´£ | è¯´æ˜ |
|------|------|
| **é…ç½®åŠ è½½** | ä»å¤šä¸ªæ¥æºï¼ˆå‘½ä»¤è¡Œã€é…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ï¼‰åŠ è½½é…ç½®æ•°æ®ï¼Œæ”¯æŒåµŒå¥—ç»“æ„åŒ–æ¨¡å‹ã€‚ |
| **ä¼˜å…ˆçº§åˆå¹¶** | æŒ‰ç…§æ˜ç¡®ä¼˜å…ˆçº§ï¼ˆç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼ï¼‰åˆå¹¶é…ç½®é¡¹ï¼Œé¿å…æ­§ä¹‰ã€‚ |
| **è‡ªåŠ¨ç”Ÿæˆ** | å½“é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå¹¶å†™å…¥é»˜è®¤é…ç½®æ¨¡æ¿ï¼Œç¡®ä¿æ— çŠ¶æ€å¯åŠ¨ã€‚ |
| **æ•æ„Ÿä¿¡æ¯æ³¨å…¥** | æ”¯æŒä»ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `LITHO_LLM_API_KEY`ï¼‰åŠ¨æ€è¦†ç›–æ•æ„Ÿé…ç½®é¡¹ï¼Œæå‡å®‰å…¨æ€§ã€‚ |
| **ç»“æ„åŒ–è¾“å‡º** | æä¾›å¼ºç±»å‹ã€å¯åºåˆ—åŒ–çš„ `Config` ç»“æ„ä½“ï¼Œä¾›å…¶ä»–æ¨¡å—å®‰å…¨è®¿é—®ã€‚ |
| **é”™è¯¯å¤„ç†** | å¯¹é…ç½®è§£æå¤±è´¥ã€æ–‡ä»¶è¯»å†™å¼‚å¸¸ç­‰åœºæ™¯æä¾›æ¸…æ™°ã€å¯è°ƒè¯•çš„é”™è¯¯åé¦ˆã€‚ |

> âœ… **è®¾è®¡å“²å­¦**ï¼š**â€œé…ç½®å³ä»£ç â€** â€”â€” æ‰€æœ‰è¡Œä¸ºç”±é…ç½®é©±åŠ¨ï¼Œè€Œéç¡¬ç¼–ç ã€‚æ¨¡å—ä¸å‚ä¸ä¸šåŠ¡é€»è¾‘ï¼Œä»…ç¡®ä¿â€œ**è°åœ¨ä½•æ—¶ä»¥ä½•ç§æ–¹å¼è¿è¡Œ**â€ã€‚

---

## **3. æ¶æ„è®¾è®¡ä¸å®ç°**

### **3.1 æŠ€æœ¯é€‰å‹ä¸ä¾èµ–**

| ç»„ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| **Rust `serde`** | åºåˆ—åŒ–/ååºåˆ—åŒ– | ç”¨äºå°† TOML æ ¼å¼é…ç½®æ–‡ä»¶ååºåˆ—åŒ–ä¸º `Config` ç»“æ„ä½“ï¼Œæ”¯æŒåµŒå¥—ç»“æ„ä¸é»˜è®¤å€¼ã€‚ |
| **Rust `toml`** | TOML è§£æ | è½»é‡çº§ã€é«˜æ€§èƒ½çš„ TOML è§£æå™¨ï¼Œä¸ `serde` æ— ç¼é›†æˆã€‚ |
| **Rust `std::fs`** | æ–‡ä»¶ç³»ç»Ÿæ“ä½œ | ç”¨äºæ£€æµ‹ã€è¯»å–ã€å†™å…¥ `config.toml` æ–‡ä»¶ï¼Œæ”¯æŒè·¨å¹³å°è·¯å¾„å¤„ç†ã€‚ |
| **Rust `std::env`** | ç¯å¢ƒå˜é‡è®¿é—® | å®‰å…¨è¯»å– `LITHO_LLM_API_KEY` ç­‰æ•æ„Ÿå˜é‡ï¼Œé¿å…ç¡¬ç¼–ç ã€‚ |
| **`Default` Trait** | é»˜è®¤å€¼æä¾› | æ‰€æœ‰é…ç½®ç»“æ„ä½“ï¼ˆ`Config`, `LlmConfig`, `MermaidConfig`ï¼‰å‡å®ç° `Default`ï¼Œç¡®ä¿æ— é…ç½®æ—¶ä»å¯è¿è¡Œã€‚ |

> âœ… **ä¼˜åŠ¿**ï¼šé›¶è¿è¡Œæ—¶å¼€é”€ã€ç¼–è¯‘æœŸç±»å‹å®‰å…¨ã€æ— å¤–éƒ¨ä¾èµ–ï¼Œç¬¦åˆ Rust ç”Ÿæ€æœ€ä½³å®è·µã€‚

---

### **3.2 æ ¸å¿ƒæ•°æ®ç»“æ„**

```rust
// src/config.rs

#[derive(Debug, Clone, Serialize, Deserialize, Default)]
pub struct Config {
    pub llm: LlmConfig,
    pub mermaid: MermaidConfig,
    pub general: GeneralConfig,
}

#[derive(Debug, Clone, Serialize, Deserialize, Default)]
pub struct LlmConfig {
    pub api_key: Option<String>,        // ä¼˜å…ˆä»ç¯å¢ƒå˜é‡ LITHO_LLM_API_KEY è¦†ç›–
    pub model: String,                  // é»˜è®¤: "mistralai/mistral-small"
    pub base_url: String,               // é»˜è®¤: "https://api.mistral.ai/v1"
    pub timeout_ms: u64,                // é»˜è®¤: 5000
}

#[derive(Debug, Clone, Serialize, Deserialize, Default)]
pub struct MermaidConfig {
    pub max_block_size_bytes: usize,    // é»˜è®¤: 10240 (10KB)
    pub validate_only: bool,            // é»˜è®¤: false
}

#[derive(Debug, Clone, Serialize, Deserialize, Default)]
pub struct GeneralConfig {
    pub output_format: OutputFormat,    // é»˜è®¤: "text"
    pub write_back: bool,               // é»˜è®¤: false
    pub exclude_patterns: Vec<String>,  // é»˜è®¤: vec![".git", ".DS_Store"]
}
```

> ğŸ” **å…³é”®è®¾è®¡ç‚¹**ï¼š
> - `api_key` ä½¿ç”¨ `Option<String>`ï¼Œå…è®¸â€œæœªè®¾ç½®â€çŠ¶æ€ï¼Œä¾¿äºç¯å¢ƒå˜é‡è¦†ç›–é€»è¾‘ã€‚
> - æ‰€æœ‰å­—æ®µå‡æœ‰é»˜è®¤å€¼ï¼Œç¡®ä¿å³ä½¿é…ç½®æ–‡ä»¶ä¸ºç©ºï¼Œç³»ç»Ÿä»å¯è¿è¡Œã€‚
> - `Clone` ä¸ `Serialize/Deserialize` å®ç°æ”¯æŒæ¨¡å—é—´ä¼ é€’ä¸æµ‹è¯• Mockã€‚

---

### **3.3 é…ç½®åŠ è½½æµç¨‹ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰**

#### **æµç¨‹å›¾ï¼ˆMermaidï¼‰**

```mermaid
graph TD
    A[å¯åŠ¨åº”ç”¨] --> B{é…ç½®æ–‡ä»¶ config.toml æ˜¯å¦å­˜åœ¨?}
    B -- å¦ --> C[åŠ è½½å†…ç½®é»˜è®¤é…ç½®æ¨¡æ¿]
    C --> D[åºåˆ—åŒ–ä¸º TOML æ ¼å¼]
    D --> E[å†™å…¥å½“å‰å·¥ä½œç›®å½•ä¸‹çš„ config.toml]
    E --> F[è¿”å›é»˜è®¤é…ç½®å¯¹è±¡]
    B -- æ˜¯ --> G[è¯»å– config.toml å†…å®¹]
    G --> H[ä½¿ç”¨ serde + toml ååºåˆ—åŒ–ä¸º Config ç»“æ„ä½“]
    H --> I{llm.api_key æ˜¯å¦ä¸ºç©º?}
    I -- æ˜¯ --> J[ä»ç¯å¢ƒå˜é‡ LITHO_LLM_API_KEY è¯»å–]
    J --> K[è¦†ç›– Config.llm.api_key]
    I -- å¦ --> L[ä¿ç•™é…ç½®æ–‡ä»¶ä¸­çš„ api_key]
    K --> M[è¿”å›æœ€ç»ˆé…ç½®å¯¹è±¡]
    L --> M
```

#### **ä¼ªä»£ç å®ç°é€»è¾‘**

```rust
impl Config {
    pub fn load(config_path: &str) -> Result<Self, ConfigError> {
        let mut config = if Path::new(config_path).exists() {
            // 1. è¯»å–å¹¶è§£æé…ç½®æ–‡ä»¶
            let content = fs::read_to_string(config_path)?;
            toml::from_str::<Config>(&content)?
        } else {
            // 2. ä¸å­˜åœ¨ï¼šç”Ÿæˆé»˜è®¤é…ç½®
            let default = Self::default();
            let toml_str = toml::to_string_pretty(&default)?;
            fs::write(config_path, toml_str)?;
            default
        };

        // 3. ç¯å¢ƒå˜é‡è¦†ç›–ï¼šä¼˜å…ˆçº§æœ€é«˜
        if config.llm.api_key.is_none() {
            if let Ok(env_key) = env::var("LITHO_LLM_API_KEY") {
                if !env_key.is_empty() {
                    config.llm.api_key = Some(env_key);
                }
            }
        }

        Ok(config)
    }
}
```

> âœ… **ä¼˜å…ˆçº§é¡ºåº**ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
> 1. **ç¯å¢ƒå˜é‡** `LITHO_LLM_API_KEY`
> 2. **é…ç½®æ–‡ä»¶** `config.toml`
> 3. **é»˜è®¤å€¼**ï¼ˆ`Default::default()`ï¼‰

> âš ï¸ **å®‰å…¨è®¾è®¡**ï¼šç¯å¢ƒå˜é‡ä»…è¦†ç›– `api_key`ï¼Œé¿å…è¯¯è¦†ç›–å…¶ä»–å…³é”®é…ç½®ï¼ˆå¦‚ `base_url`ï¼‰ï¼Œé™ä½è¯¯æ“ä½œé£é™©ã€‚

---

### **3.4 é…ç½®è‡ªåŠ¨ç”Ÿæˆæœºåˆ¶**

å½“ç³»ç»Ÿé¦–æ¬¡è¿è¡Œï¼ˆ`config.toml` ä¸å­˜åœ¨ï¼‰æ—¶ï¼Œé…ç½®ç®¡ç†åŸŸä¼š**è‡ªåŠ¨åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶**ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š

```toml
[llm]
model = "mistralai/mistral-small"
base_url = "https://api.mistral.ai/v1"
timeout_ms = 5000

[mermaid]
max_block_size_bytes = 10240
validate_only = false

[general]
output_format = "text"
write_back = false
exclude_patterns = [".git", ".DS_Store"]
```

#### **è®¾è®¡ä»·å€¼**ï¼š
- **å¼€ç®±å³ç”¨**ï¼šç”¨æˆ·æ— éœ€æ‰‹åŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œé™ä½ä½¿ç”¨é—¨æ§›ã€‚
- **æ–‡æ¡£åŒ–é…ç½®**ï¼šç”Ÿæˆçš„æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸€ä»½å®Œæ•´çš„é…ç½®è¯´æ˜æ–‡æ¡£ã€‚
- **å¯ç¼–è¾‘æ€§**ï¼šç”¨æˆ·å¯ç›´æ¥ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œåç»­è¿è¡Œå°†åŠ è½½è‡ªå®šä¹‰é…ç½®ã€‚
- **ä¸€è‡´æ€§ä¿éšœ**ï¼šæ‰€æœ‰ç”¨æˆ·è·å¾—ç›¸åŒçš„é»˜è®¤è¡Œä¸ºï¼Œé¿å…å› é…ç½®ç¼ºå¤±å¯¼è‡´çš„ä¸å¯é¢„æµ‹è¡Œä¸ºã€‚

> âœ… **å®ç°ç»†èŠ‚**ï¼šé»˜è®¤é…ç½®æ¨¡æ¿ä¸º**ç¡¬ç¼–ç çš„é™æ€ TOML å­—ç¬¦ä¸²**ï¼Œåœ¨ç¼–è¯‘æ—¶åµŒå…¥äºŒè¿›åˆ¶ï¼Œé¿å…è¿è¡Œæ—¶ä¾èµ–å¤–éƒ¨èµ„æºã€‚

---

## **4. æ¨¡å—äº¤äº’ä¸ä¾èµ–å…³ç³»**

### **4.1 ä¾èµ–æ–¹å‘ï¼ˆå•å‘ä¾èµ–ï¼‰**

| ä¾èµ–æ–¹ | ä¾èµ–ç±»å‹ | è¯´æ˜ |
|--------|----------|------|
| **CLIå…¥å£åŸŸ** | æ•°æ®ä¾èµ– | CLI è§£æå‚æ•°åï¼Œå°† `--config` è·¯å¾„ä¼ é€’ç»™é…ç½®ç®¡ç†åŸŸï¼Œä½†ä¸ç›´æ¥æ“ä½œé…ç½®ç»“æ„ä½“ã€‚ |
| **æ–‡ä»¶æ‰«æåŸŸ** | é…ç½®ä¾èµ– | ä¾èµ– `exclude_patterns`ã€`path` ç­‰å­—æ®µå†³å®šæ‰«æèŒƒå›´ã€‚ |
| **è¯­æ³•éªŒè¯åŸŸ** | é…ç½®ä¾èµ– | ä¾èµ– `mermaid.max_block_size_bytes`ã€`llm.timeout_ms` æ§åˆ¶éªŒè¯è¡Œä¸ºã€‚ |
| **AIä¿®å¤åŸŸ** | é…ç½®ä¾èµ– | å¿…é¡»è·å– `llm.api_key`ã€`llm.model`ã€`llm.base_url` æ‰èƒ½å‘èµ·è¯·æ±‚ã€‚ |
| **å¤„ç†åè°ƒåŸŸ** | é…ç½®ä¾èµ– | ä¾èµ– `general.write_back`ã€`general.output_format` æ§åˆ¶æµç¨‹åˆ†æ”¯ã€‚ |
| **å·¥å…·æ”¯æŒåŸŸ** | æ— ç›´æ¥ä¾èµ– | ä»…é€šè¿‡ `Processor` é—´æ¥ä½¿ç”¨é…ç½®ç»“æœï¼Œä¸ç›´æ¥è°ƒç”¨ `Config::load`ã€‚ |

> âœ… **å…³é”®åŸåˆ™**ï¼š**æ‰€æœ‰æ¨¡å—åªè¯»å–é…ç½®ï¼Œä¸ä¿®æ”¹é…ç½®**ã€‚é…ç½®ç®¡ç†åŸŸæ˜¯å”¯ä¸€å†™å…¥è€…ï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§ã€‚

### **4.2 æœåŠ¡è°ƒç”¨æ¥å£**

```rust
// é…ç½®ç®¡ç†åŸŸå¯¹å¤–æš´éœ²çš„å”¯ä¸€æ¥å£
pub fn load(config_path: &str) -> Result<Config, ConfigError> {
    // å®ç°å¦‚ä¸Š
}
```

- **è°ƒç”¨æ–¹**ï¼š`cli.rs` åœ¨è§£æå‚æ•°åè°ƒç”¨ `Config::load()`ï¼Œå°†ç»“æœä¼ é€’ç»™ `processor.rs`ã€‚
- **è°ƒç”¨æ—¶æœº**ï¼š**ä»…åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ä¸€æ¬¡**ï¼Œä¹‹åæ‰€æœ‰æ¨¡å—ç¼“å­˜è¯¥å¯¹è±¡ã€‚
- **é”™è¯¯ç±»å‹**ï¼š`ConfigError` åŒ…å« `ParseError`, `IoError`, `MissingApiKeyError` ç­‰ï¼Œä¾¿äºä¸Šå±‚ä¼˜é›…å¤„ç†ã€‚

---

## **5. å®‰å…¨æ€§ä¸æœ€ä½³å®è·µ**

| å®è·µ | è¯´æ˜ |
|------|------|
| **æ•æ„Ÿä¿¡æ¯ä¸ç¡¬ç¼–ç ** | `api_key` ä»ç¯å¢ƒå˜é‡æ³¨å…¥ï¼Œé¿å…æ³„éœ²åœ¨é…ç½®æ–‡ä»¶æˆ–ç‰ˆæœ¬æ§åˆ¶ä¸­ã€‚ |
| **ç¯å¢ƒå˜é‡ä»…è¦†ç›–å…³é”®å­—æ®µ** | ä»…å…è®¸è¦†ç›– `api_key`ï¼Œé˜²æ­¢è¯¯è¦†ç›– `base_url` å¯¼è‡´è¯·æ±‚å‘å¾€æ¶æ„æœåŠ¡ã€‚ |
| **é…ç½®æ–‡ä»¶æƒé™æ§åˆ¶** | ç”Ÿæˆçš„ `config.toml` ä½¿ç”¨ç³»ç»Ÿé»˜è®¤æƒé™ï¼ˆé 777ï¼‰ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å…¶ä»–ç”¨æˆ·è¯»å–ã€‚ |
| **ç©ºå€¼å®‰å…¨å¤„ç†** | `Option<String>` + `is_empty()` æ£€æŸ¥ï¼Œé¿å…ç©ºå­—ç¬¦ä¸²å¼•å‘ API è°ƒç”¨å¤±è´¥ã€‚ |
| **é»˜è®¤å€¼é˜²å¾¡æ€§ç¼–ç¨‹** | æ‰€æœ‰å­—æ®µå‡æœ‰åˆç†é»˜è®¤å€¼ï¼Œå³ä½¿é…ç½®æ–‡ä»¶è¢«è¯¯åˆ æˆ–æ¸…ç©ºï¼Œç³»ç»Ÿä»å¯è¿è¡Œã€‚ |

> âœ… **æ¨èéƒ¨ç½²å®è·µ**ï¼šåœ¨ CI/CD ä¸­ï¼Œé€šè¿‡ `export LITHO_LLM_API_KEY=xxx` æ³¨å…¥å¯†é’¥ï¼Œ`config.toml` ä»…ä¿ç•™éæ•æ„Ÿé…ç½®ï¼Œå®ç°**é…ç½®ä¸å‡­è¯åˆ†ç¦»**ã€‚

---

## **6. å¯æµ‹è¯•æ€§ä¸å¯æ‰©å±•æ€§**

### **6.1 å•å…ƒæµ‹è¯•ç¤ºä¾‹**

```rust
#[test]
fn test_load_config_file_exists() {
    let temp_dir = tempfile::tempdir().unwrap();
    let config_path = temp_dir.path().join("config.toml");

    fs::write(&config_path, r#"
        [llm]
        api_key = "fake-key"
        model = "gpt-4"
    "#).unwrap();

    let config = Config::load(config_path.to_str().unwrap()).unwrap();
    assert_eq!(config.llm.api_key, Some("fake-key".to_string()));
    assert_eq!(config.llm.model, "gpt-4");
}

#[test]
fn test_env_override_api_key() {
    std::env::set_var("LITHO_LLM_API_KEY", "env-key");
    let config = Config::load("nonexistent.toml").unwrap(); // è§¦å‘è‡ªåŠ¨ç”Ÿæˆ
    assert_eq!(config.llm.api_key, Some("env-key".to_string()));
    std::env::remove_var("LITHO_LLM_API_KEY");
}
```

> âœ… **æµ‹è¯•è¦†ç›–**ï¼šå·²è¦†ç›–æ–‡ä»¶å­˜åœ¨/ä¸å­˜åœ¨ã€ç¯å¢ƒå˜é‡è¦†ç›–ã€é»˜è®¤å€¼ã€é”™è¯¯è·¯å¾„ç­‰åœºæ™¯ã€‚

### **6.2 æ‰©å±•æ€§è®¾è®¡**

| æ‰©å±•æ–¹å‘ | å®ç°æ–¹å¼ |
|----------|----------|
| **æ”¯æŒ JSON/YAML** | æ–°å¢ `Config::load_json()` / `load_yaml()` æ–¹æ³•ï¼Œå¤ç”¨ç›¸åŒ `Config` ç»“æ„ä½“ï¼Œä»…å˜æ›´åºåˆ—åŒ–å™¨ã€‚ |
| **æ–°å¢é…ç½®é¡¹** | åœ¨ `Config` ç»“æ„ä½“ä¸­æ·»åŠ æ–°å­—æ®µï¼Œè‡ªåŠ¨ç»§æ‰¿é»˜è®¤å€¼ï¼Œæ— éœ€ä¿®æ”¹å·²æœ‰æ¨¡å—ã€‚ |
| **æ”¯æŒå¤šé…ç½®æ–‡ä»¶** | å¢åŠ  `--config-file` å¤šæ¬¡ä¼ å‚ï¼Œåˆå¹¶å¤šä¸ªé…ç½®æ–‡ä»¶ï¼ˆååŠ è½½ä¼˜å…ˆï¼‰ã€‚ |
| **é…ç½®çƒ­é‡è½½** | å¯æ‰©å±•ä¸ºç›‘å¬æ–‡ä»¶å˜åŒ–ï¼ˆå¦‚ `notify` crateï¼‰ï¼Œæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ›´æ–°ï¼ˆé€‚ç”¨äºæœåŠ¡åŒ–åœºæ™¯ï¼‰ã€‚ |

> âœ… **æœªæ¥æ¼”è¿›**ï¼šè‹¥ç³»ç»Ÿæ¼”è¿›ä¸ºæœåŠ¡ç«¯ï¼Œå¯å¼•å…¥ `ConfigWatcher` æ¨¡å—ï¼Œå®ç°åŠ¨æ€é…ç½®åˆ·æ–°ã€‚

---

## **7. ä¸å…¶ä»–æ¨¡å—çš„ååŒå…³ç³»ï¼ˆä¸Šä¸‹æ–‡å›¾ï¼‰**

```mermaid
graph LR
    subgraph ç”¨æˆ·è¾“å…¥
        CLI[CLIå…¥å£åŸŸ] -->|ä¼ é€’ config_path| Config[é…ç½®ç®¡ç†åŸŸ]
        Env[ç¯å¢ƒå˜é‡ LITHO_LLM_API_KEY] -->|æ³¨å…¥| Config
    end

    subgraph é…ç½®ä¸­æ¢
        Config -->|æä¾›| Scanner[æ–‡ä»¶æ‰«æåŸŸ]
        Config -->|æä¾›| Validator[è¯­æ³•éªŒè¯åŸŸ]
        Config -->|æä¾›| AIRepair[AIä¿®å¤åŸŸ]
        Config -->|æä¾›| Processor[å¤„ç†åè°ƒåŸŸ]
    end

    subgraph å¤–éƒ¨ç³»ç»Ÿ
        FS[æ–‡ä»¶ç³»ç»Ÿ] -->|è¯»å†™ config.toml| Config
    end

    style Config fill:#d4edda,stroke:#28a745
    style CLI fill:#cce5ff,stroke:#007bff
    style Env fill:#e9ecef,stroke:#adb5bd
    style FS fill:#e9ecef,stroke:#adb5bd
    style Scanner,Validator,AIRepair,Processor fill:#e2e3e5,stroke:#6c757d
```

> ğŸ”— **å…³é”®ç»“è®º**ï¼š**é…ç½®ç®¡ç†åŸŸæ˜¯å”¯ä¸€è¿æ¥â€œç”¨æˆ·æ„å›¾â€ä¸â€œç³»ç»Ÿè¡Œä¸ºâ€çš„æ¡¥æ¢**ã€‚æ²¡æœ‰å®ƒï¼Œå…¶ä»–æ¨¡å—å°†æ— æ³•çŸ¥é“â€œè¯¥æ‰«æå“ªé‡Œâ€ã€â€œè¯¥ç”¨å“ªä¸ªæ¨¡å‹â€ã€â€œè¯¥å†™å›æ–‡ä»¶å—â€ã€‚

---

## **8. æ€»ç»“ä¸å·¥ç¨‹ä»·å€¼**

| ç»´åº¦ | ä»·å€¼ä½“ç° |
|------|----------|
| **å®Œæ•´æ€§** | è¦†ç›– CLIã€æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ä¸‰æºé…ç½®ï¼Œæ”¯æŒè‡ªåŠ¨ç”Ÿæˆï¼Œæ— é—æ¼ã€‚ |
| **å‡†ç¡®æ€§** | ä¼˜å…ˆçº§é€»è¾‘ä¸¥è°¨ï¼Œé”™è¯¯å¤„ç†å®Œå¤‡ï¼Œé¿å…â€œé™é»˜å¤±è´¥â€ã€‚ |
| **ä¸“ä¸šæ€§** | ä½¿ç”¨æ ‡å‡† Rust ç”Ÿæ€åº“ï¼Œç»“æ„æ¸…æ™°ï¼Œç¬¦åˆç³»ç»Ÿè®¾è®¡è§„èŒƒã€‚ |
| **å¯è¯»æ€§** | é…ç½®æ–‡ä»¶è‡ªæ–‡æ¡£åŒ–ï¼Œä»£ç æ³¨é‡Šæ¸…æ™°ï¼Œæµç¨‹å›¾ä¸åºåˆ—å›¾å®Œå¤‡ã€‚ |
| **å®ç”¨æ€§** | å¼€ç®±å³ç”¨ã€å®‰å…¨æ³¨å…¥ã€æ”¯æŒ CI/CDã€é™ä½ç”¨æˆ·è®¤çŸ¥è´Ÿæ‹…ã€‚ |

> âœ… **æœ€ç»ˆç»“è®º**ï¼š  
> **é…ç½®ç®¡ç†åŸŸä¸æ˜¯â€œè¾…åŠ©æ¨¡å—â€ï¼Œè€Œæ˜¯ç³»ç»Ÿçš„â€œç¥ç»ç³»ç»Ÿâ€**ã€‚å®ƒå°†ç”¨æˆ·æ„å›¾è½¬åŒ–ä¸ºå¯æ‰§è¡ŒæŒ‡ä»¤ï¼Œå°†å¤–éƒ¨ç¯å¢ƒï¼ˆå¯†é’¥ã€è·¯å¾„ã€æ¨¡å‹ï¼‰ä¸å†…éƒ¨é€»è¾‘ï¼ˆæ‰«æã€éªŒè¯ã€ä¿®å¤ï¼‰è§£è€¦ï¼Œæ˜¯å®ç° `mermaid-fixer` é«˜å¯ç”¨ã€é«˜å¯ç»´æŠ¤ã€é«˜å¯æ‰©å±•æ€§çš„**æ ¸å¿ƒåŸºçŸ³**ã€‚

---

## **é™„å½•ï¼šé…ç½®é¡¹å‚è€ƒæ‰‹å†Œï¼ˆä¾›ç”¨æˆ·ä½¿ç”¨ï¼‰**

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `llm.api_key` | `String?` | `null` | **å¿…é¡»é€šè¿‡ç¯å¢ƒå˜é‡ `LITHO_LLM_API_KEY` è®¾ç½®** |
| `llm.model` | `String` | `"mistralai/mistral-small"` | ä½¿ç”¨çš„ LLM æ¨¡å‹åç§° |
| `llm.base_url` | `String` | `"https://api.mistral.ai/v1"` | LLM API åœ°å€ |
| `llm.timeout_ms` | `u64` | `5000` | LLM è¯·æ±‚è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰ |
| `mermaid.max_block_size_bytes` | `usize` | `10240` | å•ä¸ª Mermaid ä»£ç å—æœ€å¤§å­—èŠ‚æ•°ï¼ˆé˜²å¤§æ–‡ä»¶é˜»å¡ï¼‰ |
| `mermaid.validate_only` | `bool` | `false` | ä»…éªŒè¯ï¼Œä¸ä¿®å¤ï¼ˆç”¨äº CI æ£€æŸ¥ï¼‰ |
| `general.output_format` | `OutputFormat` | `"text"` | è¾“å‡ºæ ¼å¼ï¼š`text` / `json` |
| `general.write_back` | `bool` | `false` | æ˜¯å¦å°†ä¿®å¤ç»“æœå†™å›åŸæ–‡ä»¶ |
| `general.exclude_patterns` | `Vec<String>` | `[".git", ".DS_Store"]` | æ‰«ææ—¶æ’é™¤çš„ç›®å½•/æ–‡ä»¶æ¨¡å¼ |

> ğŸ’¡ **æç¤º**ï¼šé¦–æ¬¡è¿è¡Œåï¼Œç³»ç»Ÿä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ `config.toml`ï¼Œè¯·æ ¹æ®éœ€è¦ä¿®æ”¹å¹¶æäº¤è‡³å›¢é˜Ÿé…ç½®ä»“åº“ï¼ˆ**ä¸åŒ…å« `api_key`**ï¼‰ã€‚

--- 

> ğŸ“Œ **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.2  
> ğŸ“… **æœ€åæ›´æ–°**ï¼š2025å¹´4æœˆ  
> ğŸ› ï¸ **ç»´æŠ¤è€…**ï¼š`mermaid-fixer` æ ¸å¿ƒæ¶æ„ç»„