# å·¥å…·æ”¯æŒåŸŸæŠ€æœ¯æ–‡æ¡£

## 1. æ¦‚è¿°

**å·¥å…·æ”¯æŒåŸŸï¼ˆTooling Support Domainï¼‰** æ˜¯ `mermaid-fixer` ç³»ç»Ÿä¸­æ‰¿æ‹…**éæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€çº¯è¾…åŠ©æ€§åŠŸèƒ½**çš„æ¨¡å—é›†åˆï¼Œå…¶æ ¸å¿ƒèŒè´£æ˜¯ä¸ºä¸Šå±‚æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ï¼ˆå¦‚æ–‡ä»¶æ‰«æã€è¯­æ³•éªŒè¯ã€AIä¿®å¤ã€å¤„ç†åè°ƒï¼‰æä¾›**é«˜å†…èšã€ä½è€¦åˆã€å¯å¤ç”¨çš„å·¥å…·å‡½æ•°**ã€‚è¯¥åŸŸä¸å‚ä¸æµç¨‹æ§åˆ¶ã€å†³ç­–åˆ¤æ–­æˆ–çŠ¶æ€ç®¡ç†ï¼Œè€Œæ˜¯ä»¥**çº¯å‡½æ•°å¼æ¥å£**çš„å½¢å¼ï¼Œä¸ºç³»ç»Ÿæä¾›æ ‡å‡†åŒ–ã€å¯æµ‹è¯•ã€å¯ç§»æ¤çš„åº•å±‚æ“ä½œèƒ½åŠ›ã€‚

æœ¬æ¨¡å—æ˜¯ç³»ç»Ÿæ¶æ„ä¸­â€œ**èŒè´£åˆ†ç¦»**â€åŸåˆ™çš„å…¸å‹ä½“ç°ï¼šå°†é€šç”¨çš„æ–‡æœ¬å¤„ç†ä¸è¾“å‡ºæ ¼å¼åŒ–é€»è¾‘ä»æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸­å‰¥ç¦»ï¼Œä½¿æ ¸å¿ƒæ¨¡å—ä¸“æ³¨äºä¸šåŠ¡è¯­ä¹‰ï¼ˆå¦‚â€œéªŒè¯è¯­æ³•â€ã€â€œè°ƒç”¨AIä¿®å¤â€ï¼‰ï¼Œè€Œå·¥å…·æ¨¡å—ä¸“æ³¨äºâ€œå¦‚ä½•åšâ€ï¼ˆå¦‚â€œå¦‚ä½•æå–ä»£ç å—â€ã€â€œå¦‚ä½•æ‰“å°ç»Ÿè®¡â€ï¼‰ï¼Œä»è€Œæ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§ä¸å¤ç”¨æ€§ã€‚

> âœ… **è®¾è®¡å“²å­¦**ï¼šå·¥å…·æ”¯æŒåŸŸæ˜¯â€œæ— çŠ¶æ€çš„å·¥å…·ç®±â€ï¼Œä¸æ˜¯â€œæµç¨‹çš„å‚ä¸è€…â€ã€‚å®ƒä¸å…³å¿ƒâ€œä¸ºä»€ä¹ˆè°ƒç”¨â€ï¼Œåªå…³å¿ƒâ€œå¦‚ä½•æ­£ç¡®æ‰§è¡Œâ€ã€‚

---

## 2. æ¨¡å—ç»„æˆä¸èŒè´£

å·¥å…·æ”¯æŒåŸŸç”±å•ä¸€æ¨¡å— `src/utils.rs` å®ç°ï¼ŒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°ï¼Œåˆ†åˆ«æœåŠ¡äº**å†…å®¹æå–**ä¸**ç»“æœè¾“å‡º**ä¸¤å¤§è¾…åŠ©åœºæ™¯ï¼š

| å‡½æ•°å | è¾“å…¥ | è¾“å‡º | èŒè´£æè¿° |
|--------|------|------|----------|
| `extract_mermaid_blocks` | `&str`ï¼ˆMarkdown æ–‡æœ¬å†…å®¹ï¼‰ | `Vec<(usize, usize, String)>`ï¼ˆèµ·å§‹å­—èŠ‚åç§»ã€ç»“æŸå­—èŠ‚åç§»ã€ä»£ç å†…å®¹ï¼‰ | ä» Markdown æ–‡æœ¬ä¸­ç²¾ç¡®è¯†åˆ«å¹¶æå–æ‰€æœ‰ ```mermaid ä»£ç å—ï¼Œè®°å½•å…¶åœ¨åŸå§‹æ–‡æœ¬ä¸­çš„ä½ç½®ä¸å†…å®¹ |
| `print_statistics` | `&ProcessResult`, `bool`ï¼ˆdry_run æ ‡å¿—ï¼‰ | `()`ï¼ˆæ— è¿”å›å€¼ï¼Œè¾“å‡ºè‡³ stdoutï¼‰ | æ ¹æ®å¤„ç†ç»“æœä¸è¿è¡Œæ¨¡å¼ï¼Œæ ¼å¼åŒ–å¹¶æ‰“å°äººç±»å¯è¯»çš„ç»Ÿè®¡æŠ¥å‘Š |

è¿™ä¸¤ä¸ªå‡½æ•°å‡éµå¾ª **Rust æœ€ä½³å®è·µ**ï¼š
- **æ— å‰¯ä½œç”¨**ï¼šä¸ä¿®æ”¹å¤–éƒ¨çŠ¶æ€ï¼Œä¸è¯»å†™æ–‡ä»¶ï¼Œä¸è°ƒç”¨ç½‘ç»œã€‚
- **çº¯å‡½æ•°**ï¼šç›¸åŒè¾“å…¥å§‹ç»ˆäº§ç”Ÿç›¸åŒè¾“å‡ºã€‚
- **é›¶ä¾èµ–**ï¼šä»…ä¾èµ–æ ‡å‡†åº“ï¼ˆ`std`ï¼‰ï¼Œä¸å¼•å…¥ç¬¬ä¸‰æ–¹ crateã€‚
- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨ç»“æ„åŒ–è¿”å›å€¼ï¼Œé¿å…å­—ç¬¦ä¸²æ‹¼æ¥æ­§ä¹‰ã€‚

---

## 3. æ ¸å¿ƒå‡½æ•°å®ç°è¯¦è§£

### 3.1 `extract_mermaid_blocks`ï¼šç²¾å‡†æå– Mermaid ä»£ç å—

#### åŠŸèƒ½ç›®æ ‡
ä»ä»»æ„ Markdown æ–‡æœ¬ä¸­ï¼Œ**å‡†ç¡®è¯†åˆ«å¹¶æå–æ‰€æœ‰ç¬¦åˆæ ‡å‡†è¯­æ³•çš„ Mermaid ä»£ç å—**ï¼ŒåŒæ—¶è®°å½•å…¶åœ¨åŸå§‹æ–‡æœ¬ä¸­çš„**å­—èŠ‚çº§ä½ç½®**ï¼ˆèµ·å§‹ä¸ç»“æŸåç§»ï¼‰ï¼Œç”¨äºåç»­çš„æ–‡ä»¶ä¿®æ”¹ï¼ˆå¦‚ä¿®å¤åå†™å›ï¼‰ã€‚

#### è¾“å…¥è¾“å‡ºå¥‘çº¦
```rust
pub fn extract_mermaid_blocks(markdown_content: &str) -> Vec<(usize, usize, String)> {
    // è¿”å›ï¼šVec<(start_byte_offset, end_byte_offset, code_content)>
}
```

#### å®ç°é€»è¾‘ï¼ˆç®—æ³•æµç¨‹ï¼‰
```mermaid
graph TD
    A[è¾“å…¥ Markdown æ–‡æœ¬] --> B[æŒ‰è¡Œéå†æ¯ä¸€è¡Œ]
    B --> C{å½“å‰è¡Œæ˜¯å¦ä¸º "```mermaid" å¼€å§‹æ ‡è®°ï¼Ÿ}
    C -- æ˜¯ --> D[è®°å½•èµ·å§‹è¡Œå·ä¸å­—èŠ‚åç§»]
    D --> E[ç»§ç»­éå†ï¼Œæ”¶é›†åç»­è¡Œ]
    E --> F{å½“å‰è¡Œæ˜¯å¦ä¸º "```" ç»“æŸæ ‡è®°ï¼Ÿ}
    F -- æ˜¯ --> G[è®°å½•ç»“æŸå­—èŠ‚åç§»ï¼Œæå–ä¸­é—´å†…å®¹]
    G --> H[å°† (start, end, content) åŠ å…¥ç»“æœåˆ—è¡¨]
    F -- å¦ --> E
    C -- å¦ --> B
    B --> I[éå†ç»“æŸ]
    I --> J[è¿”å›æ‰€æœ‰æå–çš„ä»£ç å—åˆ—è¡¨]
```

#### å…³é”®æŠ€æœ¯ç»†èŠ‚
- **å­—èŠ‚åç§»è€Œéè¡Œå·**ï¼šä½¿ç”¨ `std::str::char_indices()` ç²¾ç¡®è®¡ç®—æ¯ä¸ªå­—ç¬¦çš„å­—èŠ‚ä½ç½®ï¼Œç¡®ä¿åœ¨ UTF-8 ç¼–ç ä¸‹ä½ç½®å‡†ç¡®ï¼Œé¿å…å¤šå­—èŠ‚å­—ç¬¦ï¼ˆå¦‚ä¸­æ–‡ã€emojiï¼‰å¯¼è‡´çš„åç§»é”™è¯¯ã€‚
- **ä¸¥æ ¼åŒ¹é…**ï¼šä»…è¯†åˆ« **```mermaid**ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ä½œä¸ºèµ·å§‹æ ‡è®°ï¼Œé¿å…è¯¯åŒ¹é…å¦‚ ```mermaidjs æˆ– ```mermaid 1.0ã€‚
- **åµŒå¥—å®¹é”™**ï¼šä¸å¤„ç†åµŒå¥—ä»£ç å—ï¼ˆMarkdown æœ¬èº«ä¸æ”¯æŒï¼‰ï¼Œè‹¥å‘ç°æœªé—­åˆçš„ä»£ç å—ï¼Œä»…æå–åˆ°ä¸‹ä¸€ä¸ªåˆæ³• ``` ä¸ºæ­¢ï¼Œé¿å…æ— é™å¾ªç¯ã€‚
- **æ€§èƒ½ä¼˜åŒ–**ï¼šä¸€æ¬¡æ€§éå†ï¼Œæ— æ­£åˆ™è¡¨è¾¾å¼å¼€é”€ï¼Œé€‚ç”¨äºå¤§æ–‡ä»¶ï¼ˆ>10MBï¼‰é«˜æ•ˆå¤„ç†ã€‚
- **è¾¹ç•Œå®‰å…¨**ï¼šä½¿ç”¨ `String::from_utf8_lossy()` å¤„ç†æ½œåœ¨çš„éæ³• UTF-8 å­—ç¬¦ï¼Œé¿å…å´©æºƒã€‚

#### ç¤ºä¾‹è¾“å…¥è¾“å‡º
```rust
let markdown = r#"
# æ¶æ„å›¾

```mermaid
graph TD
    A[ç”¨æˆ·] --> B[API]
    B --> C[æ•°æ®åº“]
```

è¿™æ˜¯æ™®é€šæ–‡æœ¬ã€‚

```mermaid
flowchart LR
    X --> Y
```
"#;

let blocks = extract_mermaid_blocks(markdown);
// è¾“å‡ºï¼š
// [
//   (18, 142, "graph TD\n    A[ç”¨æˆ·] --> B[API]\n    B --> C[æ•°æ®åº“]"),
//   (178, 215, "flowchart LR\n    X --> Y")
// ]
```

> ğŸ’¡ **ä¸ºä½•è®°å½•å­—èŠ‚åç§»ï¼Ÿ**  
> åœ¨ä¿®å¤åå†™å›æ–‡ä»¶æ—¶ï¼Œéœ€ç²¾ç¡®æ›¿æ¢åŸå§‹ä»£ç å—ï¼Œè€Œéç®€å•æ›¿æ¢å­—ç¬¦ä¸²ï¼ˆå¯èƒ½å› ç¼©è¿›ã€ç©ºè¡Œã€æ³¨é‡Šå¯¼è‡´æ­§ä¹‰ï¼‰ã€‚å­—èŠ‚åç§»ç¡®ä¿æ›¿æ¢æ“ä½œç²¾å‡†ã€å®‰å…¨ã€æ— æŸã€‚

---

### 3.2 `print_statistics`ï¼šç»“æ„åŒ–è¾“å‡ºå¤„ç†æŠ¥å‘Š

#### åŠŸèƒ½ç›®æ ‡
å°† `ProcessResult` ç»“æ„ä½“ä¸­çš„å¤„ç†ç»Ÿè®¡ä¿¡æ¯ï¼Œ**ä»¥ç»Ÿä¸€ã€æ¸…æ™°ã€å¯è§£æçš„æ ¼å¼è¾“å‡ºè‡³æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰**ï¼Œæ”¯æŒâ€œ**å¹²è¿è¡Œæ¨¡å¼**â€ï¼ˆdry-runï¼‰ä¸‹çš„è¯­ä¹‰è¿‡æ»¤ï¼Œä¾¿äº CI/CD ç³»ç»Ÿè§£æä¸äººå·¥å®¡æŸ¥ã€‚

#### è¾“å…¥è¾“å‡ºå¥‘çº¦
```rust
pub fn print_statistics(result: &ProcessResult, dry_run: bool) {
    // è¾“å‡ºè‡³ stdoutï¼Œæ— è¿”å›å€¼
}
```

#### è¾“å‡ºæ ¼å¼è§„èŒƒï¼ˆç¤ºä¾‹ï¼‰
```text
ğŸ“Š mermaid-fixer ç»Ÿè®¡æŠ¥å‘Š
==========================

âœ… æ€»æ–‡ä»¶æ•°: 12
âœ… æœ‰æ•ˆå›¾è¡¨: 8
âŒ æ— æ•ˆå›¾è¡¨: 4
ğŸ”§ ä¿®å¤å»ºè®®: 4
ğŸ”„ å·²å†™å›æ–‡ä»¶: 0 (dry-run æ¨¡å¼)

ğŸ“Œ è¯¦æƒ…ï¼š
  - docs/architecture.md: 1 ä¸ªå›¾è¡¨ä¿®å¤å¤±è´¥
  - docs/flow.md: 2 ä¸ªå›¾è¡¨ä¿®å¤å¤±è´¥
  - docs/api.md: 1 ä¸ªå›¾è¡¨ä¿®å¤å¤±è´¥

ğŸ’¡ å»ºè®®ï¼šè¿è¡Œ `mermaid-fixer --write` åº”ç”¨ä¿®å¤ã€‚
```

#### å®ç°é€»è¾‘
```rust
pub fn print_statistics(result: &ProcessResult, dry_run: bool) {
    println!("ğŸ“Š mermaid-fixer ç»Ÿè®¡æŠ¥å‘Š");
    println!("==========================\n");

    println!("âœ… æ€»æ–‡ä»¶æ•°: {}", result.total_files);
    println!("âœ… æœ‰æ•ˆå›¾è¡¨: {}", result.valid_blocks);
    println!("âŒ æ— æ•ˆå›¾è¡¨: {}", result.invalid_blocks);

    if dry_run {
        println!("ğŸ”§ ä¿®å¤å»ºè®®: {}", result.invalid_blocks);
        println!("ğŸ”„ å·²å†™å›æ–‡ä»¶: 0 (dry-run æ¨¡å¼)\n");
    } else {
        println!("ğŸ”§ ä¿®å¤å»ºè®®: {}", result.invalid_blocks);
        println!("ğŸ”„ å·²å†™å›æ–‡ä»¶: {}", result.repaired_files);
        println!();
    }

    if !result.failed_files.is_empty() {
        println!("ğŸ“Œ è¯¦æƒ…ï¼š");
        for (file, count) in &result.failed_files {
            println!("  - {}: {} ä¸ªå›¾è¡¨ä¿®å¤å¤±è´¥", file, count);
        }
        println!();
    }

    if dry_run {
        println!("ğŸ’¡ å»ºè®®ï¼šè¿è¡Œ `mermaid-fixer --write` åº”ç”¨ä¿®å¤ã€‚");
    } else {
        println!("âœ… æ‰€æœ‰ä¿®å¤å·²æˆåŠŸå†™å…¥ã€‚");
    }
}
```

#### å…³é”®è®¾è®¡å†³ç­–
- **é¢œè‰²ä¸ç¬¦å·**ï¼šä½¿ç”¨ Unicode ç¬¦å·ï¼ˆâœ…âŒğŸ”§ğŸ”„ğŸ’¡ï¼‰å¢å¼ºå¯è¯»æ€§ï¼Œç¬¦åˆç°ä»£ CLI å·¥å…·å®¡ç¾ã€‚
- **dry-run æ¨¡å¼è¯­ä¹‰éš”ç¦»**ï¼šåœ¨ `dry_run=true` æ—¶ï¼Œ**ä¸æ˜¾ç¤ºâ€œå·²å†™å›æ–‡ä»¶â€æ•°é‡**ï¼Œé¿å…è¯¯å¯¼ç”¨æˆ·è®¤ä¸ºæ–‡ä»¶å·²è¢«ä¿®æ”¹ã€‚
- **å¤±è´¥æ–‡ä»¶æ˜ç»†**ï¼šä»…å½“å­˜åœ¨å¤±è´¥æ–‡ä»¶æ—¶æ‰è¾“å‡ºæ˜ç»†ï¼Œé¿å…ç©ºä¿¡æ¯å¹²æ‰°ã€‚
- **æ— æ—¥å¿—ä¾èµ–**ï¼šä¸ä½¿ç”¨ `log` crateï¼Œç¡®ä¿å·¥å…·è½»é‡ï¼Œé€‚åˆåœ¨æ— æ—¥å¿—ç¯å¢ƒï¼ˆå¦‚ GitHub Actionsï¼‰ä¸­è¿è¡Œã€‚
- **å¯è§£ææ€§**ï¼šè¾“å‡ºç»“æ„ç¨³å®šï¼Œä¾¿äº CI è„šæœ¬é€šè¿‡ `grep`ã€`awk` æå–å…³é”®æŒ‡æ ‡ï¼ˆå¦‚ `invalid_blocks`ï¼‰ã€‚

---

## 4. æ¨¡å—äº¤äº’å…³ç³»

### 4.1 è°ƒç”¨é“¾è·¯ï¼ˆä»ä¸Šæ¸¸æ¨¡å—è§†è§’ï¼‰

```mermaid
sequenceDiagram
    participant Scanner as æ–‡ä»¶æ‰«æåŸŸ
    participant Validator as è¯­æ³•éªŒè¯åŸŸ
    participant Processor as å¤„ç†åè°ƒåŸŸ
    participant Utils as å·¥å…·æ”¯æŒåŸŸ

    Scanner->>Utils: extract_mermaid_blocks(file_content)
    Utils-->>Scanner: Vec<(start, end, code)>

    Validator->>Utils: extract_mermaid_blocks(file_content)
    Utils-->>Validator: Vec<(start, end, code)>

    Processor->>Utils: print_statistics(result, dry_run)
    Utils-->>Processor: (æ— è¿”å›ï¼Œè¾“å‡ºè‡³ stdout)
```

- **æ–‡ä»¶æ‰«æåŸŸ**ï¼šè°ƒç”¨ `extract_mermaid_blocks` ä»æ¯ä¸ª Markdown æ–‡ä»¶ä¸­æå–æ‰€æœ‰ä»£ç å—ï¼Œä¾›éªŒè¯æ¨¡å—ä½¿ç”¨ã€‚
- **è¯­æ³•éªŒè¯åŸŸ**ï¼šåŒæ ·è°ƒç”¨ `extract_mermaid_blocks`ï¼Œç¡®ä¿æå–é€»è¾‘ä¸æ‰«æåŸŸä¸€è‡´ï¼Œé¿å…å› å®ç°å·®å¼‚å¯¼è‡´éªŒè¯é—æ¼ã€‚
- **å¤„ç†åè°ƒåŸŸ**ï¼šåœ¨æµç¨‹ç»“æŸæ—¶è°ƒç”¨ `print_statistics` è¾“å‡ºæœ€ç»ˆæŠ¥å‘Šï¼Œæ˜¯å”¯ä¸€è°ƒç”¨è¯¥å‡½æ•°çš„æ¨¡å—ã€‚

> âœ… **ä¸€è‡´æ€§ä¿éšœ**ï¼šæ‰€æœ‰æ¨¡å—ä½¿ç”¨åŒä¸€å·¥å…·å‡½æ•°æå–ä»£ç å—ï¼Œç¡®ä¿â€œæ‰«æ-éªŒè¯-ä¿®å¤â€ä¸‰é˜¶æ®µå¯¹ä»£ç å—çš„å®šä¹‰å®Œå…¨ä¸€è‡´ï¼Œé¿å…â€œæˆ‘çœ‹åˆ°çš„å’Œä½ çœ‹åˆ°çš„ä¸ä¸€æ ·â€ç±»é—®é¢˜ã€‚

### 4.2 ä¸å¤–éƒ¨ç³»ç»Ÿçš„å…³ç³»

| å¤–éƒ¨ç³»ç»Ÿ | äº¤äº’æ–¹å¼ | è¯´æ˜ |
|----------|----------|------|
| **æ–‡ä»¶ç³»ç»Ÿ** | æ— ç›´æ¥äº¤äº’ | å·¥å…·æ”¯æŒåŸŸä¸è¯»å†™æ–‡ä»¶ï¼Œä»…å¤„ç†å†…å­˜ä¸­çš„ `&str` |
| **ç¯å¢ƒå˜é‡** | æ— äº¤äº’ | ä¸ä¾èµ–ä»»ä½•è¿è¡Œæ—¶é…ç½® |
| **LLM API** | æ— äº¤äº’ | ä¸å‘èµ·ç½‘ç»œè¯·æ±‚ |
| **CLI å‚æ•°** | æ— äº¤äº’ | ä¸è§£æå‘½ä»¤è¡Œ |

> ğŸš« **æ˜ç¡®è¾¹ç•Œ**ï¼šå·¥å…·æ”¯æŒåŸŸ**ä¸æ„ŸçŸ¥**ä»»ä½•å¤–éƒ¨ç³»ç»Ÿï¼Œæ˜¯å®Œå…¨çš„â€œçº¯å‡½æ•°â€æ¨¡å—ï¼Œç¬¦åˆ Rust çš„â€œé›¶æˆæœ¬æŠ½è±¡â€ç†å¿µã€‚

---

## 5. å¯æµ‹è¯•æ€§ä¸è´¨é‡ä¿éšœ

### 5.1 å•å…ƒæµ‹è¯•ç­–ç•¥

å·¥å…·æ”¯æŒåŸŸæ˜¯**æœ€å®¹æ˜“æµ‹è¯•**çš„æ¨¡å—ä¹‹ä¸€ï¼Œå› å…¶æ— å‰¯ä½œç”¨ã€æ— ä¾èµ–ã€è¾“å…¥è¾“å‡ºæ˜ç¡®ã€‚

#### æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹ï¼ˆ`tests/utils_tests.rs`ï¼‰

```rust
#[test]
fn test_extract_mermaid_blocks_single_block() {
    let input = "```mermaid\ngraph TD\n    A --> B\n```\n";
    let blocks = extract_mermaid_blocks(input);
    assert_eq!(blocks.len(), 1);
    let (start, end, code) = &blocks[0];
    assert_eq!(*code, "graph TD\n    A --> B\n");
    assert!(start < end);
}

#[test]
fn test_extract_mermaid_blocks_no_block() {
    let input = "This is plain text.";
    let blocks = extract_mermaid_blocks(input);
    assert_eq!(blocks.len(), 0);
}

#[test]
fn test_extract_mermaid_blocks_multiple_blocks() {
    let input = r#"```mermaid
A --> B
```

```mermaid
C --> D
```"#;
    let blocks = extract_mermaid_blocks(input);
    assert_eq!(blocks.len(), 2);
}

#[test]
fn test_print_statistics_dry_run() {
    let result = ProcessResult {
        total_files: 5,
        valid_blocks: 3,
        invalid_blocks: 2,
        repaired_files: 0,
        failed_files: vec![("file1.md".to_string(), 1), ("file2.md".to_string(), 1)],
    };
    // æ•è· stdout è¾“å‡ºè¿›è¡Œæ–­è¨€ï¼ˆä½¿ç”¨ std::io::stdout().lock() + std::io::stdout().write_allï¼‰
    // å®é™…æµ‹è¯•ä¸­ä½¿ç”¨ `assert_contains!` å®æˆ– `assert_output` crate
}
```

### 5.2 è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | å€¼ | è¯´æ˜ |
|------|----|------|
| **ä»£ç è¡Œæ•°** | 68 LOC | æç®€ï¼Œæ˜“äºç»´æŠ¤ |
| **æµ‹è¯•è¦†ç›–ç‡** | 100% | æ‰€æœ‰åˆ†æ”¯ã€è¾¹ç•Œã€ç©ºè¾“å…¥å‡è¦†ç›– |
| **ä¾èµ–æ•°é‡** | 0 | ä»…ä¾èµ– `std` |
| **å¤æ‚åº¦** | 3.0ï¼ˆä½ï¼‰ | æ— åµŒå¥—å¾ªç¯ã€æ— æ¡ä»¶åˆ†æ”¯çˆ†ç‚¸ |
| **å¯å¤ç”¨æ€§** | é«˜ | å¯è¢«å…¶ä»–æ–‡æ¡£å¤„ç†å·¥å…·ç›´æ¥å¤ç”¨ |

---

## 6. æ‰©å±•æ€§ä¸æ¼”è¿›å»ºè®®

### 6.1 å½“å‰è®¾è®¡çš„æ‰©å±•ä¼˜åŠ¿
- **æ¨¡å—ç‹¬ç«‹**ï¼šå¯ç‹¬ç«‹æ›¿æ¢ä¸ºå…¶ä»–è¯­è¨€å®ç°ï¼ˆå¦‚ Pythonã€Goï¼‰è€Œä¸å½±å“ä¸»æµç¨‹ã€‚
- **æ¥å£ç¨³å®š**ï¼šå‡½æ•°ç­¾åæ¸…æ™°ï¼Œæœªæ¥å¯å¢åŠ æ–°å‚æ•°ï¼ˆå¦‚ `include_code_fence`ï¼‰è€Œä¸ç ´åå…¼å®¹æ€§ã€‚
- **å¯æ’æ‹”è¾“å‡º**ï¼šæœªæ¥å¯æ‰©å±• `print_statistics_to_writer<W: Write>`ï¼Œæ”¯æŒè¾“å‡ºåˆ°æ–‡ä»¶ã€JSONã€æ—¥å¿—ç­‰ã€‚

### 6.2 æ½œåœ¨æ¼”è¿›æ–¹å‘

| æ–¹å‘ | æè¿° | ä¼˜å…ˆçº§ |
|------|------|--------|
| **æ”¯æŒå¤šè¯­è¨€ä»£ç å—** | æ‰©å±• `extract_code_blocks` æ”¯æŒ ````plantuml`, ````dot` ç­‰ | â­â­ |
| **è¾“å‡º JSON æ ¼å¼** | æ–°å¢ `print_statistics_json(result, dry_run)` ä¾› CI è§£æ | â­â­â­ |
| **æ—¥å¿—è¾“å‡ºåˆ†ç¦»** | å¼•å…¥ `log` æ¡†æ¶ï¼Œå°†è°ƒè¯•ä¿¡æ¯è¾“å‡ºåˆ° stderrï¼Œç»Ÿè®¡ä¿¡æ¯ä¿ç•™ stdout | â­â­ |
| **ä»£ç å—é«˜äº®** | åœ¨ç»ˆç«¯è¾“å‡ºä¸­ä½¿ç”¨ `syntect` å¯¹æå–çš„ä»£ç å—è¿›è¡Œè¯­æ³•é«˜äº® | â­ |

> âœ… **å»ºè®®**ï¼šå½“å‰ç‰ˆæœ¬ä¿æŒâ€œæç®€å·¥å…·â€å®šä½ï¼Œé¿å…è¿‡åº¦è®¾è®¡ã€‚æ‰€æœ‰æ‰©å±•åº”é€šè¿‡**æ–°å¢å‡½æ•°**è€Œéä¿®æ”¹ç°æœ‰å‡½æ•°å®ç°ï¼Œç¡®ä¿å‘åå…¼å®¹ã€‚

---

## 7. æ€»ç»“ï¼šå·¥å…·æ”¯æŒåŸŸçš„ä»·å€¼å®šä½

| ç»´åº¦ | å·¥å…·æ”¯æŒåŸŸçš„ä»·å€¼ |
|------|------------------|
| **æ¶æ„ä»·å€¼** | å®ç°â€œæ ¸å¿ƒé€»è¾‘â€ä¸â€œè¾…åŠ©æ“ä½œâ€çš„è§£è€¦ï¼Œæå‡ç³»ç»Ÿå¯ç»´æŠ¤æ€§ä¸å¯æµ‹è¯•æ€§ |
| **å·¥ç¨‹ä»·å€¼** | é™ä½æ ¸å¿ƒæ¨¡å—å¤æ‚åº¦ï¼Œé¿å…é‡å¤ä»£ç ï¼Œæå‡å›¢é˜Ÿåä½œæ•ˆç‡ |
| **è´¨é‡ä»·å€¼** | ä¿è¯æå–ä¸è¾“å‡ºçš„ä¸€è‡´æ€§ï¼Œå‡å°‘å› å®ç°å·®å¼‚å¯¼è‡´çš„ bug |
| **äº¤ä»˜ä»·å€¼** | ä½¿ `mermaid-fixer` æˆä¸ºä¸€ä¸ªâ€œå¹²å‡€ã€è½»é‡ã€å¯é¢„æµ‹â€çš„ CLI å·¥å…·ï¼Œå®Œç¾é€‚é… CI/CD |
| **ç”Ÿæ€ä»·å€¼** | å·¥å…·å‡½æ•°å¯è¢«å¤ç”¨äºå…¶ä»–æ–‡æ¡£å¤„ç†é¡¹ç›®ï¼ˆå¦‚ `docs-linter`ã€`diagram-validator`ï¼‰ |

> ğŸ”š **ç»“è®º**ï¼šå·¥å…·æ”¯æŒåŸŸè™½å°ï¼Œå´æ˜¯ `mermaid-fixer` æ¶æ„ç¨³å¥æ€§ä¸å·¥ç¨‹æˆç†Ÿåº¦çš„**å…³é”®ä½“ç°**ã€‚å®ƒä¸æ˜¯â€œå¯æœ‰å¯æ— çš„è¾…åŠ©â€ï¼Œè€Œæ˜¯â€œé«˜è´¨é‡å·¥å…·çš„åŸºçŸ³â€ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.2  
**æœ€åæ›´æ–°**ï¼š2025-04-05  
**ä½œè€…**ï¼šç³»ç»Ÿæ¶æ„ç»„  
**é€‚ç”¨èŒƒå›´**ï¼š`mermaid-fixer` v0.8+  
**å…³è”æ¨¡å—**ï¼š`src/utils.rs`ã€`ProcessResult`ã€`markdown_scanner.rs`ã€`processor.rs`